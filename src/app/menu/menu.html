<div class="container mt-4" style="max-width: 600px">
  <app-cart-preview></app-cart-preview>
</div>

<div class="container mt-4">
  <div class="row g-4">
    @for (pizza of pizzas$ | async; track pizza.id) {
      <div class="col-12 col-md-4">
        <div class="card h-100 shadow-sm d-flex flex-column" [class.opacity-50]="!pizza.available">
          <img [src]="pizza.imageUrl" class="pizza-img" alt="{{ pizza.name }}" />

          <div class="card-body d-flex flex-column">
            <h5 class="card-title">{{ pizza.name }}</h5>

            <p class="card-text text-muted">
              {{ pizza.description }}
            </p>

            <div class="mb-2" *ngIf="pizza.toppings?.length">
              <strong>Toppings:</strong>
              <div class="d-flex flex-wrap gap-1 mt-1">
                @for (t of pizza.toppings; track $index) {
                  <span class="badge bg-secondary">{{ t }}</span>
                }
              </div>
            </div>

            <div class="mb-3">
              <label class="form-label fw-semibold">Quantity</label>
              <div class="input-group input-group-sm">
                <button
                  class="btn btn-outline-secondary"
                  (click)="decreaseQuantity(pizza.id)"
                  [disabled]="!pizza.available"
                >
                  −
                </button>

                <input
                  type="number"
                  min="1"
                  class="form-control"
                  [(ngModel)]="quantities[pizza.id]"
                  [disabled]="!pizza.available"
                />

                <button
                  class="btn btn-outline-secondary"
                  (click)="increaseQuantity(pizza.id)"
                  [disabled]="!pizza.available"
                >
                  +
                </button>
              </div>
            </div>

            <div class="mb-2">
              <label class="form-label fw-semibold">Size</label>
              <select
                class="form-select form-select-sm"
                [(ngModel)]="selectedSize[pizza.id]"
                [disabled]="!pizza.available"
              >
                @for (s of sizes; track s) {
                  <option [value]="s">{{ s }}</option>
                }
              </select>
            </div>

            <div class="mt-auto d-flex justify-content-between align-items-center">
              <span class="fw-bold">€ {{ pizza.price }}</span>
              <button
                class="btn btn-primary btn-sm"
                (click)="addToCart(pizza)"
                [disabled]="!pizza.available"
              >
                Add to cart
              </button>
            </div>

            <!-- Unavailable badge -->
            <span *ngIf="!pizza.available" class="badge bg-secondary mt-2 text-center w-100">
              Unavailable
            </span>
          </div>
        </div>
      </div>
    }
  </div>
</div>
